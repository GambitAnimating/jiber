import { createSaveRoom } from './save-room'
import { RoomState } from 'jiber-core'

////////////////////////////////////////////////////////////////////////////////
// mocks
////////////////////////////////////////////////////////////////////////////////
let calledSetState: any

const getRoomState = () => {
  return {confirmed: 'sue', lastUpdatedAt: 33, members: {}}
}

const stashState = (roomId: string, roomState: RoomState) => {
  calledSetState = {roomId, roomState}
  return Promise.resolve()
}

const snapshotInterval = 1000

////////////////////////////////////////////////////////////////////////////////
// setup
////////////////////////////////////////////////////////////////////////////////
const saveRoom = createSaveRoom(snapshotInterval, getRoomState, stashState)

////////////////////////////////////////////////////////////////////////////////
// tests
////////////////////////////////////////////////////////////////////////////////
test('it should get the room state and pass it to db', async () => {
  await saveRoom('room1')
  expect(calledSetState).toEqual({
    roomId: 'room1',
    roomState: {confirmed: 'sue', lastUpdatedAt: 33, members: {}}
  })
})
